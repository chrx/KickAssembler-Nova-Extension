<?xml version="1.0" encoding="UTF-8"?>
<syntax name="kickassembler">
    <meta>
        <name>Kick Assembler</name>
        <type>structured</type>
        <preferred-file-extension>asm</preferred-file-extension>
    </meta>

    <detectors>
        <extension priority="1.0">asm,a,s,S,inc,lib,kick,ka,src</extension>
    </detectors>

    <indentation>
        <increase>
            <expression>(\{[^}\"']*$)</expression>
        </increase>
        <decrease>
            <expression>^\s*(\s*/\*.*\*/\s*)*[\}]</expression>
        </decrease>
    </indentation>

    <comments>
        <multiline>
            <starts-with>
                <expression>/\*</expression>
            </starts-with>
            <ends-with>
                <expression>\*/</expression>
            </ends-with>
        </multiline>
        <single>
            <expression>//</expression>
        </single>
    </comments>

    <brackets>
        <pair open="[" close="]" />
        <pair open="{" close="}" />
        <pair open="(" close=")" />
    </brackets>

    <surrounding-pairs>
        <pair open="{" close="}" />
        <pair open="[" close="]" />
        <pair open="(" close=")" />
        <pair open="&apos;" close="&apos;" />
        <pair open="&quot;" close="&quot;" />
    </surrounding-pairs>

    <scopes>
        <include syntax="self" collection="values" />
        <include syntax="self" collection="strings" />
        <include syntax="self" collection="comments" />
        <include syntax="self" collection="labels" />
        <include syntax="self" collection="opcodes" />
        <include syntax="self" collection="processing" />
        <include syntax="self" collection="registers" />
        <include syntax="self" collection="constants" />
        <include syntax="self" collection="symbols" />
        <include syntax="self" collection="operators" />
    </scopes>

    <collections>
        <collection name="values">
            <scope name="kickassembler.value.number.dec">
                <expression>\#?[0-9]+\b</expression>
            </scope>
            <scope name="kickassembler.value.number.hex">
                <expression>\#?\$[a-fA-F0-9]+\b</expression>
            </scope>
            <scope name="kickassembler.value.number.bin">
                <expression>\#?\%[01]+\b</expression>
            </scope>
        </collection>

        <collection name="operators">
            <scope name="kickassembler.operator.numeric">
                <expression>(\|\||==|!=|&lt;=|&gt;=|&amp;&amp;|&lt;&lt;|&gt;&gt;|[-+*/%&lt;&gt;&amp;|^~!])</expression>
            </scope>
        </collection>

        <collection name="comments">
            <scope name="kickassembler.comment.single" spell-check="false">
                <expression>(//)(.*)$</expression>
                <capture number="2" name="kickassembler.comment.content" />
            </scope>
            <scope name="kickassembler.comment.block" spell-check="false">
                <starts-with>
                    <expression>/\*\*?</expression>
                </starts-with>
                <ends-with>
                    <expression>\*/</expression>
                </ends-with>
            </scope>

        </collection>

        <collection name="strings">
            <scope name="kickassembler.string" spell-check="false">
                <starts-with>
                    <expression>&quot;</expression>
                </starts-with>
                <ends-with>
                    <expression>&quot;</expression>
                </ends-with>
            </scope>
            <scope name="kickassembler.string.char">
                <expression>&apos;\S&apos;</expression>
            </scope>
        </collection>

        <collection name="labels">
            <scope name="kickassembler.identifier.function.name">
                <expression>(?:^\s*|;\s*)(((!)|(!?(@*[A-Za-z_][A-Za-z0-9_]*)+))\:)</expression>
            </scope>
        </collection>

        <collection name="symbols">
            <scope name="kickassembler.value.number.immediate">
                <expression>\#([A-Za-z_@!][A-Za-z0-9_]*(?:\.[A-Za-z_][A-Za-z0-9_]*)*)\b</expression>
            </scope>

            <scope name="kickassembler.identifier.variable">
                <symbol type="variable" scope="local" />
                <expression>([@!]*[A-Za-z_][A-Za-z0-9_]*(?:\.[A-Za-z_][A-Za-z0-9_]*)*)(\+|\-)?\b</expression>
            </scope>
        </collection>

        <collection name="opcodes">
            <scope name="keyword">
                <strings case-insensitive="true">
                    <string>adc</string>
                    <string>and</string>
                    <string>asl</string>
                    <string>bit</string>
                    <string>clc</string>
                    <string>cld</string>
                    <string>cli</string>
                    <string>clv</string>
                    <string>cmp</string>
                    <string>cpx</string>
                    <string>cpy</string>
                    <string>dec</string>
                    <string>dex</string>
                    <string>dey</string>
                    <string>eor</string>
                    <string>inc</string>
                    <string>inx</string>
                    <string>iny</string>
                    <string>lda</string>
                    <string>ldx</string>
                    <string>ldy</string>
                    <string>lsr</string>
                    <string>nop</string>
                    <string>ora</string>
                    <string>pha</string>
                    <string>php</string>
                    <string>pla</string>
                    <string>plp</string>
                    <string>rol</string>
                    <string>ror</string>
                    <string>sbc</string>
                    <string>sec</string>
                    <string>sed</string>
                    <string>sei</string>
                    <string>sta</string>
                    <string>stx</string>
                    <string>sty</string>
                    <string>tax</string>
                    <string>txa</string>
                    <string>tay</string>
                    <string>tya</string>
                    <string>tsx</string>
                    <string>txs</string>
                    <string>bcc</string>
                    <string>bcs</string>
                    <string>beq</string>
                    <string>bmi</string>
                    <string>bne</string>
                    <string>bpl</string>
                    <string>brk</string>
                    <string>bvc</string>
                    <string>bvs</string>
                    <string>jmp</string>
                    <string>jsr</string>
                    <string>rti</string>
                    <string>rts</string>
                </strings>
            </scope>
            <scope name="invalid.illegal">
                <strings case-insensitive="true">
                    <string>aac</string>
                    <string>aax</string>
                    <string>ahx</string>
                    <string>alr</string>
                    <string>anc</string>
                    <string>anc2</string>
                    <string>ane</string>
                    <string>arr</string>
                    <string>aso</string>
                    <string>asr</string>
                    <string>atx</string>
                    <string>axa</string>
                    <string>axs</string>
                    <string>dcm</string>
                    <string>dcp</string>
                    <string>dop</string>
                    <string>hlt</string>
                    <string>ins</string>
                    <string>isb</string>
                    <string>isc</string>
                    <string>jam</string>
                    <string>kil</string>
                    <string>lae</string>
                    <string>lar</string>
                    <string>las</string>
                    <string>lds</string>
                    <string>lax</string>
                    <string>lse</string>
                    <string>lxa</string>
                    <string>oal</string>
                    <string>rla</string>
                    <string>rra</string>
                    <string>sax</string>
                    <string>sbc2</string>
                    <string>sbx</string>
                    <string>skb</string>
                    <string>sha</string>
                    <string>shs</string>
                    <string>say</string>
                    <string>shx</string>
                    <string>shy</string>
                    <string>slo</string>
                    <string>skw</string>
                    <string>sre</string>
                    <string>sxa</string>
                    <string>sya</string>
                    <string>tas</string>
                    <string>top</string>
                    <string>xaa</string>
                    <string>xas</string>
                </strings>
            </scope>

            <scope name="keyword">
                <strings case-insensitive="true">
                    <string>bra</string>
                    <string>sac</string>
                    <string>sir</string>
                    <string>bbr0</string>
                    <string>bbr1</string>
                    <string>bbr2</string>
                    <string>bbr3</string>
                    <string>bbr4</string>
                    <string>bbr5</string>
                    <string>bbr6</string>
                    <string>bbr7</string>
                    <string>bbs0</string>
                    <string>bbs1</string>
                    <string>bbs2</string>
                    <string>bbs3</string>
                    <string>bbs4</string>
                    <string>bbs5</string>
                    <string>bbs6</string>
                    <string>bbs7</string>
                    <string>phx</string>
                    <string>phy</string>
                    <string>plx</string>
                    <string>ply</string>
                    <string>rmb0</string>
                    <string>rmb1</string>
                    <string>rmb2</string>
                    <string>rmb3</string>
                    <string>rmb4</string>
                    <string>rmb5</string>
                    <string>rmb6</string>
                    <string>rmb7</string>
                    <string>smb0</string>
                    <string>smb1</string>
                    <string>smb2</string>
                    <string>smb3</string>
                    <string>smb4</string>
                    <string>smb5</string>
                    <string>smb6</string>
                    <string>smb7</string>
                    <string>stp</string>
                    <string>stz</string>
                    <string>trb</string>
                    <string>tsb</string>
                    <string>wai</string>
                </strings>
            </scope>

            <scope name="keyword">
                <strings case-insensitive="true">
                    <string>asw</string>
                    <string>cle</string>
                    <string>cpz</string>
                    <string>dew</string>
                    <string>dez</string>
                    <string>eom</string>
                    <string>inw</string>
                    <string>inz</string>
                    <string>lbcc</string>
                    <string>lbcs</string>
                    <string>lbeq</string>
                    <string>lbmi</string>
                    <string>lbne</string>
                    <string>lbpl</string>
                    <string>lbra</string>
                    <string>lbsr</string>
                    <string>lbvc</string>
                    <string>lbvs</string>
                    <string>ldz</string>
                    <string>map</string>
                    <string>neg</string>
                    <string>phw</string>
                    <string>phz</string>
                    <string>plz</string>
                    <string>row</string>
                    <string>rtn</string>
                    <string>see</string>
                    <string>tab</string>
                    <string>taz</string>
                    <string>tba</string>
                    <string>tsy</string>
                    <string>tys</string>
                    <string>tza</string>
                    <string>adcq</string>
                    <string>andq</string>
                    <string>aslq</string>
                    <string>asrq</string>
                    <string>bitq</string>
                    <string>cpq</string>
                    <string>deq</string>
                    <string>eorq</string>
                    <string>inq</string>
                    <string>ldq</string>
                    <string>lsrq</string>
                    <string>orq</string>
                    <string>rolq</string>
                    <string>rorq</string>
                    <string>sbcq</string>
                    <string>stq</string>
                </strings>
            </scope>

            <scope name="kickassembler.keyword.operator">
                <strings case-insensitive="true">
                    <string>abs</string>
                    <string>acos</string>
                    <string>asin</string>
                    <string>atan</string>
                    <string>atan2</string>
                    <string>cbrt</string>
                    <string>ceil</string>
                    <string>cos</string>
                    <string>cosh</string>
                    <string>exp</string>
                    <string>expm1</string>
                    <string>floor</string>
                    <string>hypot</string>
                    <string>IEEEremainder</string>
                    <string>log</string>
                    <string>log10</string>
                    <string>log1p</string>
                    <string>max</string>
                    <string>min</string>
                    <string>pow</string>
                    <string>mod</string>
                    <string>random</string>
                    <string>round</string>
                    <string>signum</string>
                    <string>sin</string>
                    <string>sinh</string>
                    <string>sqrt</string>
                    <string>tan</string>
                    <string>tanh</string>
                    <string>toDegrees</string>
                    <string>toRadians</string>
                </strings>
            </scope>

            <scope name="kickassembler.processing">
                <expression>(?:^|\s)(\.)(?i)(word|wo|byte|text|te|dword|by|dw|zp|var|const|label|memblock|fill)\b</expression>
            </scope>
            <scope name="kickassembler.processing.arguments">
                <expression>\b(CmdArgument)\b</expression>
            </scope>
            <scope name="kickassembler.processing.namespace">
                <expression>\b(getNamespace)\b</expression>
            </scope>
            <scope name="kickassembler.processing.string">
                <expression>\b(toIntString|toBinaryString|toOctalString|toHexString)\b</expression>
            </scope>
            <scope name="kickassembler.processing.object.method">
                <expression>[A-Za-z0-9_)]\.([A-Za-z_][A-Za-z0-9_]+)\(</expression>
                <capture number="1" name="kickassembler.processing.string" />
            </scope>
            <scope name="kickassembler.processing.load">
                <expression>\b(LoadBinary|LoadPicture|LoadSid|createFile)</expression>
            </scope>
            <scope name="kickassembler.processing.math.3d">
                <expression>\b(Matrix|RotationMatrix|ScaleMatrix|MoveMatrix|PerspectiveMatrix|Vector)\b</expression>
            </scope>
            <scope name="kickassembler.processing.field">
                <expression>(?:^|\s)(\.)(?i)(var|label|const)\b</expression>
            </scope>
            <scope name="kickassembler.processing.object">
                <expression>(?:^|\s)(\.)(?i)(struct|enum|define)\b</expression>
            </scope>
            <scope name="kickassembler.processing.function">
                <expression>(?:^|\s)(\.)(?i)(eval|fill|break|print|printnow|import|align|assert|asserterror|error|errorif|lohifill|fillword)\b</expression>
            </scope>
            <scope name="kickassembler.processing.command">
                <expression>(?:^|\s)(\.)(?i)(pc|importonce|pseudopc|return|cpu|disk|file|filemodify|segment|segmentdef|segmentout|memblock|modify|plugin)\b</expression>
            </scope>
            <scope name="kickassembler.processing.command">
                <expression>(?:^\s*|;\s*)(\*)(?=\s*\=\s*)</expression>
            </scope>
            <scope name="kickassembler.processing.encoding">
                <expression>(?:^|\s)(\.)(?i)(encoding)\b</expression>
            </scope>
            <scope name="kickassembler.processing.import">
                <expression>(\#)(?i)(importif|importonce|import)</expression>
            </scope>
            <scope name="kickassembler.processing.import.mode">
                <expression>(?:^|\s)((\.import)\s+(?i)(binary|c64|source|text))\b</expression>
                <capture number="2" name="kickassembler.processing.command" />
                <capture number="3" name="kickassembler.processing.import.mode" />
            </scope>
            <scope name="kickassembler.keyword.preprocessor">
                <expression>(\#)(?i)(undef|define|if|else|elif|endif)</expression>
            </scope>
            <scope name="kickassembler.processing.segments">
                <expression>(\.)(?i)(segmentdef|segmentout|segment)</expression>
            </scope>
            <scope name="kickassembler.processing.files">
                <expression>(\.)(?i)(file)</expression>
            </scope>
        </collection>

        <collection name="processing">
            <scope name="kickassembler.definition.method">
                <expression>(?:^\s*|;\s*)((\.pseudocommand)\s*(@*[A-Za-z_][A-Za-z0-9_]*))\b</expression>
                <capture number="2" name="kickassembler.processing.command" />
                <capture number="3" name="kickassembler.identifier.function.name" />
            </scope>

            <scope name="kickassembler.definition.method">
                <expression>(?:^\s*|;\s*)((\.function)\s*(@*[A-Za-z_][A-Za-z0-9_]*))\b</expression>
                <capture number="2" name="kickassembler.processing.command" />
                <capture number="3" name="kickassembler.identifier.function.name" />
            </scope>

            <scope name="kickassembler.definition.macro">
                <expression>(?:^\s*|;\s*)((\.macro)\s*(@*[A-Za-z_][A-Za-z0-9_]*))\b</expression>
                <capture number="2" name="kickassembler.processing.command" />
                <capture number="3" name="kickassembler.identifier.function.name" />
            </scope>

            <scope name="kickassembler.definition.class">
                <expression>(?:^\s*|;\s*)((\.filenamespace)\s*([A-Za-z_][A-Za-z0-9_]*))\b</expression>
                <capture number="2" name="kickassembler.processing.command" />
                <capture number="3" name="kickassembler.identifier.type.class" />
            </scope>
            <scope name="kickassembler.definition.class">
                <expression>(?:^\s*|;\s*)((\.namespace)\s*([A-Za-z_][A-Za-z0-9_]*))\b</expression>
                <capture number="2" name="kickassembler.processing.command" />
                <capture number="3" name="kickassembler.identifier.type.class" />
            </scope>
            <scope name="kickassembler.keyword.control.for">
                <expression>(?:^|\s)(\.for)\s*\(\s*(var)?</expression>
                <capture number="1" name="kickassembler.keyword.control" />
                <capture number="2" name="kickassembler.processing.field" />
            </scope>
            <scope name="kickassembler.keyword.control.if">
                <expression>(?:^|\s)((\.if)\b|(else)\b)</expression>
                <capture number="1" name="kickassembler.keyword.control" />
            </scope>
            <scope name="kickassembler.keyword.control.while">
                <expression>(?:^|\s)(\.while)(?=\s*\(.*\))</expression>
                <capture number="1" name="kickassembler.keyword.control" />
            </scope>
        </collection>

        <collection name="constants">
            <scope name="kickassembler.constant.language.boolean">
                <expression>\b(true|false)\b</expression>
            </scope>
            <scope name="kickassembler.constant.language.null">
                <expression>\b(null)\b</expression>
            </scope>
            <scope name="kickassembler.value.number.colour">
                <expression>\#?(BLACK|WHITE|RED|CYAN|PURPLE|GREEN|BLUE|YELLOW|ORANGE|BROWN|LIGHT_RED|DARK_GRAY|GRAY|DARK_GREY|GREY|LIGHT_GREEN|LIGHT_BLUE|LIGHT_GRAY|LIGHT_GREY)\b</expression>
            </scope>
            <scope name="kickassembler.value.number.opcodetype">
                <expression>\#?(?:ADC|AND|ASL|BIT|CLC|CLD|CLI|CLV|CMP|CPX|CPY|DEC|DEX|DEY|EOR|INC|INX|INY|LDA|LDX|LDY|LSR|NOP|ORA|PHA|PHP|PLA|PLP|ROL|ROR|SBC|SEC|SED|SEI|STA|STX|STY|TAX|TXA|TAY|TYA|TSX|TXS|BCC|BCS|BEQ|BMI|BNE|BPL|BRK|BVC|BVS|JMP|JSR|RTI|RTS)(?:_(?:IMM|ZP|ZPX|ZPY|IZPX|IZPY|ABS|ABSX|ABSY|IND|REL))?\b</expression>
            </scope>
            <scope name="kickassembler.identifier.constant.filetype">
                <strings case-insensitive="false">
                    <string>BF_C64FILE</string>
                    <string>BF_BITMAP_SINGLECOLOR</string>
                    <string>BF_KOALA</string>
                    <string>BF_FLI</string>
                    <string>BF_DOODLE</string>
                </strings>
            </scope>
            <scope name="kickassembler.identifier.constant.cpu">
                <expression>\b(_6502NoIllegals|_6502|dtv|_65c02|_65ce02|_45gs02)\b</expression>
            </scope>
            <scope name="kickassembler.identifier.constant.pseudocommand">
                <expression>\b(AT_ABSOLUTE|AT_ABSOLUTEX|AT_ABSOLUTEY|AT_IMMEDIATE|AT_INDIRECT|AT_IZEROPAGEX|AT_IZEROPAGEY|AT_NONE)\b</expression>
            </scope>
            <scope name="kickassembler.identifier.constant.math">
                <expression>\b(PI|E)\b</expression>
            </scope>
            <scope name="kickassembler.identifier.type.hashtable">
                <expression>\b(Hashtable)\b</expression>
            </scope>
            <scope name="kickassembler.identifier.type.list">
                <expression>\b(list|List)\(\s*(\$?\d+)*\s*\)</expression>
                <capture number="1" name="kickassembler.identifier.type.list" />
                <capture number="2" name="kickassembler.value.number" />
            </scope>
        </collection>

        <collection name="registers">
            <scope name="kickassembler.identifier.argument.registers">
                <expression>\b(?i)(a|x|y)\b</expression>
            </scope>
        </collection>

    </collections>
</syntax>
